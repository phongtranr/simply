{{!-- Layout --}}
{{!< default}}

<header class="author-header">
    <div class="px-4 py-12 md:py-vw6 mx-auto max-w-3xl text-center">
        <h1 class="text-3xl md:text-4xl text-title">{{t "The full archive"}}</h1>
        <div class="mt-5 text-lg text-gray-500">{{t "There are {total} posts in total" total=pagination.total}}</div>
    </div>
</header>

<div class="site-post container mx-auto pb-10">
    <div class="feed-entry-wrap max-w-3xl mx-auto">

        {{#foreach posts}}
        <article class="archive-post" data-year="{{date format="YYYY"}}" data-month="{{date format="MM"}}">
            <header class="archive-heading flex items-baseline px-6 pt-6 pb-2" data-archive-heading>
                <h2 class="archive-month flex items-baseline gap-3 text-2xl font-bold capitalize">
                    <span class="archive-month-name">{{date format="MMMM"}}</span>
                    <span class="archive-year text-base font-semibold uppercase tracking-[0.35em] text-gray-500">{{date format="YYYY"}}</span>
                </h2>
            </header>
            <a class="archive-link block text-title hover:text-dark" href="{{url}}">
                <div class="border-t border-gray-200 px-6 py-4 transition hover:bg-amber-300/60">
                    <h2 class="archive-title text-xl font-bold">{{title}}</h2>
                    {{!-- Date Time and reading Time - ./partials/components/datetime.hbs --}}
                    {{> "components/datetime" class="mt-2 text-gray-500 text-sm"}}
                </div>
            </a>
        </article>
        {{/foreach}}
    </div>
</div>

{{#contentFor "header"}}
<style>
    .archive-post + .archive-post .archive-heading {
        border-top: 1px solid rgba(203, 213, 225, 1);
    }
</style>
{{/contentFor}}

{{#contentFor "scripts"}}
<script>
    (function () {
        var wrapper = document.querySelector('.feed-entry-wrap')
        if (!wrapper) {
            return
        }
        var articles = Array.prototype.slice.call(wrapper.querySelectorAll('.archive-post[data-year][data-month]'))
        if (!articles.length) {
            return
        }
        var seenYears = []
        var seenMonths = []
        articles.forEach(function (article) {
            var year = article.getAttribute('data-year')
            var month = article.getAttribute('data-month')
            var heading = article.querySelector('[data-archive-heading]')
            var monthLabel = heading ? heading.querySelector('.archive-month') : null
            if (!year || !month) {
                return
            }

            if (seenYears.indexOf(year) === -1) {
                seenYears.push(year)
                article.id = 'year-' + year
            }

            var monthKey = year + '-' + month
            if (monthLabel) {
                if (seenMonths.indexOf(monthKey) !== -1) {
                    if (heading && heading.parentNode) {
                        heading.parentNode.removeChild(heading)
                    }
                } else {
                    seenMonths.push(monthKey)
                }
            }
        })
    })()
</script>
{{/contentFor}}
