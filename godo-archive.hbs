{{!-- Layout --}}
{{!< default}}

<header class="author-header">
    <div class="px-4 py-12 md:py-vw6 mx-auto max-w-3xl text-center">
        <h1 class="text-3xl md:text-4xl text-title">{{t "The full archive"}}</h1>
        <div class="mt-5 text-lg text-gray-500">{{t "There are {total} posts in total" total=pagination.total}}</div>
    </div>
</header>

<div class="site-post container mx-auto pb-16">
    <div class="feed-entry-wrap mx-auto max-w-4xl">
        <div class="archive-timeline">
            {{#foreach posts}}
                <article class="archive-post" data-year="{{date format="YYYY"}}" data-month="{{date format="MM"}}">
                    <header class="archive-heading" data-archive-heading>
                        <div class="archive-heading-year" data-archive-year>
                            <span class="archive-year-value">{{date format="YYYY"}}</span>
                        </div>
                        <div class="archive-heading-month" data-archive-month>
                            <span class="archive-month-name">{{date format="MMMM"}}</span>
                        </div>
                    </header>
                    <a class="archive-link" href="{{url}}">
                        <div class="archive-card">
                            <h2 class="archive-title">{{title}}</h2>
                            <time class="archive-date" datetime="{{date format="YYYY-MM-DD"}}">{{date format="DD MMM"}}</time>
                        </div>
                    </a>
                </article>
            {{/foreach}}
        </div>
    </div>
</div>

{{#contentFor "scripts"}}
<script>
    (function () {
        var wrapper = document.querySelector('.feed-entry-wrap')
        if (!wrapper) {
            return
        }
        var articles = Array.prototype.slice.call(wrapper.querySelectorAll('.archive-post[data-year][data-month]'))
        if (!articles.length) {
            return
        }
        var seenYears = []
        var seenMonths = []
        articles.forEach(function (article) {
            var year = article.getAttribute('data-year')
            var month = article.getAttribute('data-month')
            var heading = article.querySelector('[data-archive-heading]')
            var yearLabel = heading ? heading.querySelector('[data-archive-year]') : null
            var monthLabel = heading ? heading.querySelector('[data-archive-month]') : null
            if (!year || !month) {
                return
            }

            if (seenYears.indexOf(year) === -1) {
                seenYears.push(year)
                article.id = 'year-' + year
                article.classList.add('archive-post--year-start')
            } else if (yearLabel) {
                yearLabel.classList.add('archive-year--hidden')
                yearLabel.setAttribute('aria-hidden', 'true')
            }

            var monthKey = year + '-' + month
            if (monthLabel) {
                if (seenMonths.indexOf(monthKey) !== -1) {
                    if (heading) {
                        heading.classList.add('archive-heading--hidden')
                        heading.setAttribute('aria-hidden', 'true')
                    }
                } else {
                    seenMonths.push(monthKey)
                    heading.classList.add('archive-heading--month-start')
                }
            }

        })
    })()
</script>
{{/contentFor}}
