{{!-- Homepage archive navigation linking to yearly sections on the archive channel --}}
{{#if @custom.home_archive_strip}}
    {{#get "posts" limit="200" filter="tag:-[hash-portfolio,hash-kusi-doc,hash-podcast]" order="published_at desc" as |archive_posts|}}
        {{#if archive_posts}}
            <section class="home-archive-strip">
                <div class="archive-strip__inner">
                    <div class="archive-strip__content">
                        <h2 class="archive-strip__heading">{{t "From the Archive"}}</h2>
                        <nav class="archive-year-links" aria-label="Archive years">
                            {{#foreach archive_posts}}
                                <a class="archive-year-tile" href="/archive/#year-{{date published_at format="YYYY"}}" data-year="{{date published_at format="YYYY"}}">{{date published_at format="YYYY"}}</a>
                            {{/foreach}}
                        </nav>
                    </div>
                </div>
            </section>
            <script>
                (function () {
                    var script = document.currentScript
                    if (!script) {
                        return
                    }
                    var container = script.previousElementSibling
                    if (!container) {
                        return
                    }
                    var nav = container.querySelector('nav.archive-year-links')
                    if (!nav) {
                        return
                    }
                    var seenYears = []
                    Array.prototype.slice.call(nav.querySelectorAll('a[data-year]')).forEach(function (link) {
                        var year = link.getAttribute('data-year')
                        if (seenYears.indexOf(year) !== -1) {
                            link.parentNode.removeChild(link)
                        } else {
                            seenYears.push(year)
                        }
                    })
                })()
            </script>
        {{/if}}
    {{/get}}
{{/if}}
